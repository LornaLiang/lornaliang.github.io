<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  };
</script>

<script async id="MathJax-script"
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script>
(function () {
  var typeMap = {
    TIP: "tip",
    NOTE: "note",
    IMPORTANT: "important",
    WARNING: "warning",
    CAUTION: "caution"
  };

  function typesetMath(elems) {
    // MathJax is loaded async; wait until it's available then typeset.
    if (window.MathJax && typeof window.MathJax.typesetPromise === "function") {
      window.MathJax.typesetPromise(elems);
      return;
    }
    var tries = 0;
    var timer = setInterval(function () {
      tries += 1;
      if (window.MathJax && typeof window.MathJax.typesetPromise === "function") {
        clearInterval(timer);
        window.MathJax.typesetPromise(elems);
      } else if (tries >= 50) { // ~5 seconds
        clearInterval(timer);
      }
    }, 100);
  }

  function transform() {
    var touched = [];

    var quotes = document.querySelectorAll("blockquote");
    quotes.forEach(function (bq) {
      if (bq.classList.contains("admonition")) return; // avoid double transform

      var p = bq.querySelector(":scope > p");
      if (!p) return;

      var text = (p.textContent || "").trim();
      var m = text.match(/^\[\!(TIP|NOTE|IMPORTANT|WARNING|CAUTION)\]\s*/i);
      if (!m) return;

      var raw = m[1].toUpperCase();
      var type = typeMap[raw];
      if (!type) return;

      var rest = text.replace(m[0], "").trim();

      bq.classList.add("admonition", "admonition--" + type);

      var title = document.createElement("div");
      title.className = "admonition__title";
      title.textContent = raw.charAt(0) + raw.slice(1).toLowerCase();

      bq.insertBefore(title, p);

      if (rest) {
        p.textContent = rest;
      } else {
        p.remove();
      }

      touched.push(bq);
    });

    // Typeset only changed blocks (fast) and safe for async MathJax load.
    if (touched.length) {
      typesetMath(touched);
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", transform);
  } else {
    transform();
  }
})();
</script>

